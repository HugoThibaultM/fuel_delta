import requests
import time
import json

# Configuraci√≥n de SimHub (Por defecto es puerto 8888)
SIMHUB_URL = "http://127.0.0.1:8888/api/getgamedata"

def monitor_desde_simhub():
    print(f"--- CONECTANDO CON SIMHUB (Puerto 8888) ---")
    print("Aseg√∫rate de que SimHub est√° abierto y las agujas se mueven.")

    try:
        while True:
            try:
                # Pedimos los datos a SimHub (es una petici√≥n web local)
                response = requests.get(SIMHUB_URL, timeout=0.5)
                
                if response.status_code == 200:
                    data = response.json()
                    
                    # SimHub nos da un diccionario gigante. Buscamos lo que necesitamos.
                    # Nota: Los nombres de variables en SimHub suelen ser estandarizados.
                    
                    rpms = data.get('Rpms', 0)
                    fuel = data.get('Fuel', 0)
                    max_fuel = data.get('MaxFuel', 0)
                    gear = data.get('Gear', '-')
                    speed = data.get('SpeedKmh', 0)
                    
                    # Si el juego est√° pausado o en men√∫, a veces devuelve 0 o null
                    if data.get('GameRunning'):
                        estado = "üü¢ EN PISTA"
                    else:
                        estado = "‚è∏Ô∏è PAUSA/MEN√ö"

                    print(f"\r{estado} | üèéÔ∏è RPM: {rpms:.0f} | ‚õΩ Fuel: {fuel:.2f}/{max_fuel:.0f} L | ‚öôÔ∏è Marcha: {gear}", end="")
                
                else:
                    print(f"\r‚ùå Error SimHub: {response.status_code}", end="")

            except requests.exceptions.ConnectionError:
                print(f"\r‚ùå No se encuentra SimHub. ¬øEst√° abierto?", end="")
            
            # Consultamos 10 veces por segundo (suficiente para combustible)
            time.sleep(0.1)

    except KeyboardInterrupt:
        print("\nMonitor detenido.")

if __name__ == "__main__":
    # Si no tienes la librer√≠a 'requests', inst√°lala abriendo terminal y escribiendo:
    # pip install requests
    monitor_desde_simhub()
